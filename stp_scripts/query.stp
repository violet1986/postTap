#!/usr/bin/env stap
probe process("/usr/local/pgsql/bin/postgres").function("ExecutorStart").call   
{
    printdln("|", pid(), ppfunc(), "ctime", ctime())
}
probe process("/usr/local/pgsql/bin/postgres").function("ExecutorFinish").call 
{ 
    printdln("|", pid(), ppfunc(), "ctime", ctime())
}
probe process("/usr/local/pgsql/bin/postgres").function("CreateQueryDesc").call   
{
    printdln("|", pid(), ppfunc(), "var", "MyDatabaseId", @var("MyDatabaseId"))
    sourceText = pointer_arg(2)
    if (sourceText != 0) {
        printdln("|", pid(), ppfunc(), "var", "arg_2", kernel_string(sourceText))
    }
}
probe process("/usr/local/pgsql/bin/postgres").function("InitPostgres").call   
{
    dbname = pointer_arg(1)
    username = pointer_arg(3)
    if (dbname != 0 && username != 0) {
        printf("%d %s: %s %s\n", pid(), ppfunc(), kernel_string(dbname), kernel_string(username))
    }
}

probe process("/usr/local/pgsql/bin/postgres").function("get_database_name").call   
{
    printf("%d %s %d\n", pid(), ppfunc(), u64_arg(1))
}
